angular.module("rtBase.services",[]),function(){var a=angular.module("rtBase.services");a.service("rtResponseTransFormer",["$q",function(a){return{transform:function(b){var c=a.defer();return b.api_response?1==b.success?c.resolve(b):c.reject(b.errors):c.resolve(b),c.promise}}}])}(),function(){var a=angular.module("rtBase.services");a.factory("rtXhrStateHandler",["$window",function(a){function b(){function b(){c.message=e.message,c.isIdle=e==d[0],c.isWorking=e==d[1],c.isComplete=e==d[2],c.isSuccess=e==d[3],c.isError=e==d[4],c.isFatal=e==d[5]}var c={},d=[{message:""},{message:"Working"},{message:"Complete"},{message:"Success"},{message:"Error"},{message:"Fatal"}],e=d[0];return c.setAllMessages=function(a){for(var b=0;b<d.length;b++)a[b]||(a[b]=""),d[b].message=a[b]},c.setMessageForState=function(a,b){d[a]&&(d[a].message=b)},c.reset=function(){c.idle()},c.idle=function(){e=d[0],b()},c.initiate=function(){e=d[1],b()},c.complete=function(){e=d[2],b()},c.success=function(){e=d[3],b()},c.error=function(){e=d[4],b()},c.fatal=function(c){e=d[5],b(),c&&a.alert("An unexpected error occurred while processing this request. Please refresh the page and try again.")},c}return b.getInstance=function(){var a=new b;return a.idle(),a},b}])}(),function(){var a=angular.module("rtBase.services");a.service("rtLocation",["$q",function(a){return{get:function(){var b=a.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){var c=[a.coords.latitude,a.coords.longitude].join(",");b.resolve(c)},function(){b.reject()}):b.reject(),b.promise}}}])}(),angular.module("rtBase",["rtBase.services"]),angular.module("rtRestaurant",["ngResource","rtBase"]),function(){var a=angular.module("rtRestaurant");a.service("rtRestaurant.Model",["rtRestaurantFetcher","$q",function(a,b){var c={},d=c;return d.collection=[],d.executeQuery=function(c,d){b.defer();return a.fetch(c,d)},d.loadCollection=function(a){this.collection=a},d.emptyCollection=function(){this.collection=[]},d.loadErrors=function(a){this.errors=a},d.emptyErrors=function(){this.errors=[]},d.hasErrors=function(){return!_.isEmpty(this.errors)},d.count=function(){return d.collection?d.collection.length:0},c}])}(),function(){var a=angular.module("rtRestaurant");a.service("rtRestaurantFetcher",["$q","$http","rtResponseTransFormer",function(a,b,c){return{fetch:function(d,e){var f=a.defer(),g="/api/search/";return b({method:"GET",url:g+d,params:e}).success(function(a){c.transform(a).then(function(a){f.resolve(a,e)},function(a){f.reject(a,e)})}).error(function(a){f.reject(a)}),f.promise}}}])}(),angular.module("rtHome",["rtRestaurant"]),function(){var a=angular.module("rtHome");a.controller("rtHome.MainController",["$scope","rtRestaurant.Model","rtLocation","$anchorScroll","$location","rtXhrStateHandler","$timeout",function(a,b,c,d,e,f){function g(){a.xhrState=new f,a.xhrState.setAllMessages(["Now!","Loading","Now!","Now!","Retry","Fatal"]),a.xhrState.idle(),a.Restaurant=b,a.find=l,a.dirty=!1,a.locationQuery=!0,a.scrollToTop=i}function h(){e.hash("restaurants-list"),d()}function i(){e.hash("hero"),d()}function j(){$timeout(function(){a.$apply()},2500)}function k(){b.loadErrors("We were unable to get you location"),h()}function l(){a.dirty=!0,a.xhrState.initiate(),c.get().then(function(c){b.executeQuery("location_query",{coordinates:c,cuisines:a.cuisines}).then(function(b){a.Restaurant.loadCollection(b.data.restaurants),a.Restaurant.emptyErrors(),a.xhrState.complete(),a.response=_.omit(b,"data","errors"),h(),j()},function(b){a.Restaurant.emptyCollection(),a.Restaurant.loadErrors(b),a.xhrState.error(),h(),j()})},k)}g()}])}(),angular.module("rtSearch",[]),function(){var a=angular.module("rtSearch");a.controller("rtSearch.MainController",["$scope","rtRestaurant.Model","$anchorScroll","$location","rtXhrStateHandler","$timeout",function(a,b,c,d,e){function f(){a.xhrState=new e,a.xhrState.setAllMessages(["Now!","Loading","Now!","Now!","Retry","Fatal"]),a.xhrState.idle(),a.Restaurant=b,a.dirty=!1,a.find=j,a.scrollToTop=h}function g(){d.hash("restaurants-list"),c()}function h(){d.hash("hero"),c()}function i(){$timeout(function(){a.$apply()},2500)}function j(){a.dirty=!0,a.xhrState.initiate(),b.executeQuery("text_query",{query:a.query}).then(function(b){a.Restaurant.loadCollection(b.data.restaurants),a.Restaurant.emptyErrors(),a.xhrState.complete(),a.response=_.omit(b,"data","errors"),g(),i()},function(b){a.Restaurant.emptyCollection(),a.Restaurant.loadErrors(b),a.xhrState.error(),g(),i()})}f()}])}(),function(){"use strict";var a=angular.module("rt",["rtHome","rtSearch","ngRoute"]);a.config(["$routeProvider","$httpProvider",function(a){a.when("/home",{templateUrl:"views/home.html",controller:"rtHome.MainController"}).when("/search",{templateUrl:"views/search.html",controller:"rtSearch.MainController"}).otherwise({redirectTo:"/home"})}])}();